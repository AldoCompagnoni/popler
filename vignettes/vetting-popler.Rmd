---
title: "Vetting popler"
author: "Aldo Compagnoni"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction: identifying groups of data sets

The popler R package was built to foster scientific synthesis using LTER long-term data. The premise of such synthesis is using data from many research projects that share characteristics of scientific interest. To identify projects sharing salient attributes, popler uses the metadata information associated with each LTER project. In particular, it is farily easy to select projects based on one or more of the following features:

 1. Replication, temporal or spatial.
 2. Taxonomic group.
 3. Study characteristics. 
 4. Geographic location.

Vetting the database based on these criteria is very intuitive. However, popler also facilitates identifying data sets in many other, more flexible ways. Below we provide several examples on how to select LTER data based on the four types of features described above. Moreover, in the final section we also show how to carry out more complicated types of searches.

### 1. Replication
#### Temporal replication

If you are interested in long-term data, you will likely want to select projects based on how long the data was collected for. This is very straightforward using the 

```{r, warning = FALSE, message = FALSE}
library(popler)
browse(duration_years > 10)
```

Note that most LTER projects contemplate sampling at a yearly or sub-yearly frequency. Thus, studies longer than 10 years generally guarantee a longitudinal series of 10 or more observations. The variable "samplefreq" characterizes the sample frequency of each study. [COMMENT: "samplefreq" is not browse() and dictionary() default settings. Still debating whether I should describe *full_tbl* right away or below]: 

```{r, warning = FALSE, message = FALSE}
dictionary("samplefreq")
browse(samplefreq == "monthly")
```

#### Spatial replication

[COMMENT: Need to create derived variables `tot_spatial_rep`, `n_spatial_levels` in `project_table`]


###2. Taxonomic group

To selecting information based on taxonomic groups, simply specify which group and which category you wish to select. The default settings of popler provide seven taxonomic groups: kingdom, phylum, class, order, family, genus, and species: 

```{r, warning = FALSE, message = FALSE}
dictionary("class")
browse(class == "Insecta")
```

###3. Study characteristics

Metadata information provides a few variables to select studies based on their a straightforward way. In particular:

 - `studytype`: indicates whether the study is observational or experimental. 
 - `treatment_type`: type of treatments, if study is experimental.
 - `community`: does project provide data on multiple species?

Below we provie several three examples on how to use these three fields. 

```{r, warning = FALSE, message = FALSE}
dictionary("community")
browse(community == "no") # 8 single-species studies

dictionary("treatment_type_1")
nrow( browse(treatment_type_1 == "grazing") ) # 2 grazing studies

dictionary("studytype")
nrow( browse(studytype == "obs") ) # 28 observational studies
```

### 4. Geographic location.

To select studies based on the latitude and longitude of the LTER headquarters, simply use the `lat_lter` and `lng_lter` numeric variables: 

```{r, warning = FALSE, message = FALSE}
dictionary( c("lat_lter","lng_lter") )
browse(lat_lter > 40 & lng_lter < -100) # single-species studies
```

### 5. More complicated searches

Popler allows more complicated searches.  

 - combine several types of metadata information.
 - use keywords.
 
## The argument `full_tbl`

Metadata information in popler consists of 60 variables. The default settings in `dictionary()` only show 17 variables. Setting the arugment `full_tbl=T` shows a description for each of the 60 variables. 

1. metadata info (`dictionary()`).
1. metadata info (`dictionary(full_tbl=T)`).


## The `schema()` function

`schema()` returns a description of all the variables contained in popler. It returns a list where each element refers to a specific table of the data base. Each element is a data frame with two columns: the names of the variables contained in the table, and its description.
Differences in both 

 - `schema()` can also open a figure of the graphical representation of the schema of popler.
 - Or should we just save the schema as data using devtools::use_data?



